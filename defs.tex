\catcode`@=11

\ifx\@defsloaded\relax
	\immediate\write16{defs.tex: warning: loaded multiple times}
	\expandafter\endinput
\else
	\let\@defsloaded=\relax
\fi


%%% DEBUGGING/TESTING %%%

\def\supershowlists{\par
	{\showboxdepth=1000 \showboxbreadth=1000000 \showlists}}
\def\vruletest{\smash{\vrule height\vsize depth\vsize}}


%%% UTIL %%%

% Shortcut---long chains of expandafters can be a lot of characters.
\let\ea=\expandafter

\def\@gobble#1{}
\def\1#1#2{#1} % I.e., firstoftwo
\def\2#1#2{#2} % I.e., secondoftwo

% Zero pad a positive integer. E.g., \zeropad{000}{13} => 013.
% Idea from https://tex.stackexchange.com/a/412225/202281.
\def\zeropad#1#2{\ifnum1#1>1#2 \zeropad{#1}{0#2}\else#2\fi}

% Strip "pt" off the end of \the\dimenX. Argument must be fully expanded.
{\catcode`\p=12 \catcode`\t=12 \gdef\@#1pt{#1}}
\let\@strippt=\@ \let\@=\@undefined

% Convert 4 digit hex number #2#3#4#5 to decimal in range [0,1) and store
% it in #1.
\newdimen\@htddimen
\def\@hextodec#1#2#3#4#5{%
	\@htddimen="#2#3#4#5sp \edef#1{\ea\@strippt\the\@htddimen}}


%%% PARAMETERS/REGISTER ALLOCATION %%%

% \parindent, prob@sidesize, item@indent, and pc@sideskip should
% be kept in sync so that indentations look consistent.

\parindent=0pt
\parskip=\smallskipamount

\newskip\hugeskipamount \hugeskipamount=24pt plus8pt minus8pt
\newcount\verbpenalty   \verbpenalty=0
\newdimen\prob@sidesize \prob@sidesize=20pt
\newdimen\prob@rulegap  \prob@rulegap=5pt
\newskip\prob@topskip   \prob@topskip=12pt plus6pt minus2pt
\newdimen\item@indent   \item@indent=20pt

% Registers for temporary use.
\newcount\@count \newcount\@@count
\newskip\@skip   \newskip\@@skip
\newdimen\@dimen \newdimen\@@dimen
\newbox\@box     \newbox\@@box


%%% FONTS %%%

% We use 10/7/5 for normal text, and 9/6/5 for problem statement text.
% Little/no effort has been made to make sure math symbols work properly with
% non-standard fonts (but the Latin/Greek letters should work fine).
% Plain TeX default fams, for reference:
%  0 = rm             (10/7/5)
%  1 = math it        (10/7/5)
%  2 = math symbols   (10/7/5)
%  3 = math extension (10/10/10)
%  4 = text it        (10//)
%  5 = sl             (10//)
%  6 = bf             (10/7/5)
%  7 = tt             (10//)

% Misc fonts
\font\bigbf=cmbx12 scaled \magstep1 % Title.
\font\twelvebf=cmbx12 % Problem headings.

\font\ninerm=cmr9
\font\sixrm=cmr6

\font\ninei=cmmi9 \skewchar\ninei='177
\font\sixi=cmmi6  \skewchar\sixi='177

\font\ninesy=cmsy9 \skewchar\ninesy='60
\font\sixsy=cmsy6  \skewchar\sixsy='60

\font\nineit=cmti9

\font\ninesl=cmsl9

\font\ninebf=cmbx9
\font\sixbf=cmbx6

\font\ninett=cmtt9

\font\tensc=cmcsc10
\font\ninesc=cmcsc9

\font\tenss=cmss10
\font\niness=cmss9
% \font\sevenss=cmss7
% \font\sixss=cmss6
% \font\fivess=cmss5

\font\tenbb=msbm10
\font\ninebb=msbm9
\font\sevenbb=msbm7
\font\sixbb=msbm6
\font\fivebb=msbm5

\font\tenscr=stix-mathscr at 10pt
\font\ninescr=stix-mathscr at 9pt
\font\sevenscr=stix-mathscr at 7pt
\font\sixscr=stix-mathscr at 6pt
\font\fivescr=stix-mathscr at 5pt

\font\teneucal=eusm10
\font\nineeucal=eusm9
\font\seveneucal=eusm7
\font\sixeucal=eusm6
\font\fiveeucal=eusm5

\font\tenbmit=cmmib10  \skewchar\tenbmit='177
\font\ninebmit=cmmib9  \skewchar\ninebmit='177
\font\sevenbmit=cmmib7 \skewchar\sevenbmit='177
\font\sixbmit=cmmib6   \skewchar\sixbmit='177
\font\fivebmit=cmmib5  \skewchar\fivebmit='177

% Plain TeX does not provide names for fams 0 through 4, so we add them.
\chardef\rmfam=0
\chardef\mitfam=1
\chardef\syfam=2
\chardef\exfam=3
% itfam = 4
% slfam = 5
% bffam = 6
% ttfam = 7
\newfam\scfam
\newfam\ssfam
\newfam\bbfam
\newfam\scrfam
\newfam\eucalfam
\newfam\bmitfam

\def\initfam#1#2#3#4{%
	\textfont#1=#2%
	\scriptfont#1=#3%
	\scriptscriptfont#1=#4}

% These 4 switches, along with \mit (fam1) and \cal (fam2) don't change
% the current font, only the fam, so they don't need to be redefed in \tenpt
% or \ninept.
\def\bb{\fam=\bbfam}
\def\scr{\fam=\scrfam}
\def\eucal{\fam=\eucalfam}
\def\bmit{\fam=\bmitfam}

\def\tenpt{%
	\initfam\rmfam\tenrm\sevenrm\fiverm
	\initfam\mitfam\teni\seveni\fivei
	\initfam\syfam\tensy\sevensy\fivesy
	\initfam\itfam\tenit\nullfont\nullfont
	\initfam\slfam\tensl\nullfont\nullfont
	\initfam\bffam\tenbf\sevenbf\fivebf
	\initfam\ttfam\tentt\nullfont\nullfont
	\initfam\scfam\tensc\nullfont\nullfont
	\initfam\ssfam\tenss\nullfont\nullfont
	\initfam\bbfam\tenbb\sevenbb\fivebb
	\initfam\scrfam\tenscr\sevenscr\fivescr
	\initfam\eucalfam\teneucal\seveneucal\fiveeucal
	\initfam\bmitfam\tenbmit\sevenbmit\fivebmit
	\def\rm{\fam=\rmfam \tenrm}%
	\def\it{\fam=\itfam \tenit}%
	\def\sl{\fam=\slfam \tensl}%
	\def\bf{\fam=\bffam \tenbf}%
	\def\tt{\fam=\ttfam \tentt}%
	\def\sc{\fam=\scfam \tensc}%
	\def\ss{\fam=\ssfam \tenss}%
	\setbox\strutbox=\hbox{\vrule height8.5pt depth3.5pt width0pt}%
	% These are the default values from plain TeX.
	\abovedisplayskip=12pt plus3pt minus9pt
	\belowdisplayskip=12pt plus3pt minus9pt
	\abovedisplayshortskip=0pt plus3pt
	\belowdisplayshortskip=7pt plus3pt minus4pt
	\normalbaselineskip=12pt
	\normalbaselines\rm}

\def\ninept{%
	\initfam\rmfam\ninerm\sixrm\fiverm
	\initfam\mitfam\ninei\sixi\fivei
	\initfam\syfam\ninesy\sixsy\fivesy
	\initfam\itfam\nineit\nullfont\nullfont
	\initfam\slfam\ninesl\nullfont\nullfont
	\initfam\bffam\ninebf\sixbf\fivebf
	\initfam\ttfam\ninett\nullfont\nullfont
	\initfam\scfam\ninesc\nullfont\nullfont
	\initfam\ssfam\niness\nullfont\nullfont
	\initfam\bbfam\ninebb\sixbb\fivebb
	\initfam\scrfam\ninescr\sixscr\fivescr
	\initfam\eucalfam\nineeucal\sixeucal\fiveeucal
	\initfam\bmitfam\ninebmit\sixbmit\fivebmit
	\def\rm{\fam=\rmfam \ninerm}%
	\def\it{\fam=\itfam \nineit}%
	\def\sl{\fam=\slfam \ninesl}%
	\def\bf{\fam=\bffam \ninebf}%
	\def\tt{\fam=\ttfam \ninett}%
	\def\sc{\fam=\scfam \ninesc}%
	\def\ss{\fam=\ssfam \niness}%
	\setbox\strutbox=\hbox{\vrule height8pt depth3pt width0pt}%
	% I chose these values without too much thought,
	% so maybe they're not very good.
	\abovedisplayskip=10pt plus3pt minus7pt
	\belowdisplayskip=10pt plus3pt minus7pt
	\abovedisplayshortskip=0pt plus3pt
	\belowdisplayshortskip=6pt plus3pt minus3pt
	\normalbaselineskip=11pt
	\normalbaselines\rm}

\tenpt


%%% VERTICAL SKIPS %%%

\def\hugeskip{\vskip\hugeskipamount}
\def\hugebreak{\par \ifdim\lastskip<\hugeskipamount
	\removelastskip \penalty-400 \hugeskip \fi}

% \revskip replaces the previous glue on the vertical list with the
% specified glue.
\def\revskip{\par\removelastskip\vskip}
\def\resmallskip{\revskip\smallskipamount}
\def\remedskip{\revskip\medskipamount}
\def\rebigskip{\revskip\bigskipamount}
\def\rehugeskip{\revskip\hugeskipamount}

% \@vskip inserts the specified glue only if \lastskip=0pt (i.e., if the last
% item on the current vertical list isn't a glue). The intented use is for
% macros that typically insert glue before some content (e.g., a figure or an
% algorithm), so that the user can override the glue before the content simply
% by specifying an explicit skip before using the macro. Also, the penalty in
% register \@penalty is inserted before the glue if \@penalty isn't 0,
% and \@penalty is zeroed.
\newcount\@penalty \@penalty=0
\def\@vskip{%
	\par\begingroup
	\def\@{\ifdim\lastskip=0pt
		\ifnum\@penalty=0 \else \penalty\@penalty \fi
		\vskip\@skip \fi \global\@penalty=0 \endgroup}%
	\afterassignment\@\@skip=}
\def\@smallskip{\@vskip\smallskipamount}
\def\@medskip{\@vskip\medskipamount}
\def\@bigskip{\@vskip\bigskipamount}
\def\@hugeskip{\@vskip\hugeskipamount}
\def\@smallbreak{\@penalty-50 \@smallskip}
\def\@medbreak{\@penalty-100 \@medskip}
\def\@bigbreak{\@penalty-200 \@bigskip}
\def\@hugebreak{\@penalty-400 \@hugeskip}

% Change parskip until after the next paragraph.
\newskip\tps@oldparskip
\def\tmpparskip#1{%
	\ifx\tps@oldpar\@undefined
		\global\let\tps@oldpar=\par
		\global\tps@oldparskip=\parskip
		\gdef\@restoreparskip{%
			\global\parskip=\tps@oldparskip
			\global\let\par=\tps@oldpar
			\global\let\tps@oldpar=\@undefined}
		\gdef\par{\ifhmode \@restoreparskip\par \fi}%
	\fi
	\global\parskip=#1}
\let\@restoreparskip=\relax
\def\noparskip{\tmpparskip{0pt}}
\def\yesparskip{\@restoreparskip}


%%% TEXT %%%

% Lists, with dedicated macros for up to 3 levels of nesting.
\let\itemitem=\@undefined
\def\item{\@item1}
\def\iitem{\@item2}
\def\iiitem{\@item3}
\def\@item#1#2{%
	\par \hangafter=0 \hangindent=#1\item@indent
	\noindent\llap{\rm#2\enspace}\ignorespaces}

% Like Plain TeX narrower, but advance left/rightskip by specified ammount
% instead of by parindent.
\def\narrowerby#1{%
	\advance \leftskip  by #1%
	\advance \rightskip by #1}

% Spread tokens in #1 by glue in #2.
% E.g., "abcd" => "a  b  c  d".
\def\spread#1#2{%
	\def\@terminator##1\@help{}%
	\def\@help##1{##1\hskip#2\relax\@help}%
	\@help#1\@terminator\unskip}

% Plain TeX only provides llap and rlap.
\def\clap#1{\hbox to0pt{\hss#1\hss}}

% Surround content, which should be a box, with rules.
\def\vboxit#1{\vbox{\hrule\hbox{\vrule#1\vrule}\hrule}}

% Same as plain raggedright, but 2em changed to 3em, and it advances rightskip,
% instead of setting it.
\def\raggedright{%
	\advance \rightskip by 0pt plus 3em
	\spaceskip=0.3333em \xspaceskip=0.5em\relax}

% Theorems+proof, lemmas+proof, definitions, etc.
% Plain TeX proclaim has been modified to use \@penalty \@vskip constructions
% and suppress parskip.
\def\proclaim #1. #2\par{%
	\par \@medbreak \noparskip
	\noindent{\bf#1.\enspace}{\sl#2\par}%
	\@penalty55 \@medskip \noparskip}
\def\proof{% use \proof ... \qed
	\par \@medskip \noparskip
	\begingroup \let\@qed=\qed \def\qed{\@qed\@medskip\noparskip\endgroup}%
	\noindent{\it Proof.\enspace}}
\def\qedbox{\rect{0.6em}{0.6em}{0.5pt}}
\def\qed{\unskip\hskip1em plus1fil \hbox{}\nobreak\hfill$\qedbox$\par}


%%% MATH %%%

% Shortcuts
\let\dsty=\displaystyle
\let\tsty=\textstyle
\let\ssty=\scriptstyle
\let\sssty=\scriptscriptstyle
\let\lc=\lceil
\let\rc=\rceil
\let\lf=\lfloor
\let\rf=\rfloor

% Alternate names
\let\:=\colon % Punctuation colon. Regular colon is a relation.
\let\lxor=\oplus
\let\limp=\rightarrow
\let\liff=\leftrightarrow
\let\grad=\nabla
\let\del=\partial

% https://www.tug.org/TUGboat/tb22-4/tb72perlS.pdf
\def\mathllap{\mathpalette\@mathllapinternal}
\def\mathrlap{\mathpalette\@mathrlapinternal}
\def\mathclap{\mathpalette\@mathclapinternal}
\def\@mathllapinternal#1#2{\llap{$\m@th#1{#2}$}}
\def\@mathrlapinternal#1#2{\rlap{$\m@th#1{#2}$}}
\def\@mathclapinternal#1#2{\clap{$\m@th#1{#2}$}}

% Integrals
\def\d{{\rm d}} % Preceed with \, usually.
\def\dx{\d x} \def\dy{\d y} \def\dt{\d t}
\def\@intkern{\mkern-9mu\mathchoice{\mkern-5mu}{}{}{}}
\def\iint{\int\@intkern\int\nolimits}
\def\iiint{\int\@intkern\int\@intkern\int\nolimits}

% For \sums mainly. This just sticks .25ex between lines,
% which seems to work well enough.
\def\substack#1{\vtop{%
	\baselineskip=-1000pt \lineskip=.25ex \lineskiplimit=\maxdimen
	\ialign{\hfil$\ssty##$\hfil\crcr#1\crcr}}}

% \imp to match \iff.
\def\imp{\;\Longrightarrow\;}

% Sets
\def\N{{\bb N}}
\def\Z{{\bb Z}}
\def\Q{{\bb Q}}
\def\R{{\bb R}}
\def\powset{{\scr P}}

% Big O and friends
% bigomega and bigtheta are upright, so bigo should be too, hence eucal
% (but not just a roman O, since it looks too much like zero).
% \Omega and \Theta are class 7, so make sure they get typeset in \rm.
% \omega is class 0, so no worries there.
\def\bigo{{\eucal O}}
\def\littleo{{\mit o}}
\def\bigomega{{\rm \Omega}}
\def\littleomega{\omega}
\def\bigtheta{{\rm \Theta}}

% i/j/k vector components.
\def\ihat{{\bf\mathaccent"705E \mathchar"7010}}
\def\jhat{{\bf\mathaccent"705E \mathchar"7011}}
\def\khat{{\bf\mathaccent"705E k}}

\def\?{\buildrel?\over=}
\def\falling#1#2{#1^{\underline{#2}}}
\def\rising#1#2{#1^{\overline{#2}}}
\def\rect#1#2#3{% inner width, inner height, line thickness 
	\vcenter{\vbox{%
		\hrule height#3%
		\hbox{\vrule width#3height#2\kern#1\vrule width#3}%
		\hrule height#3}}}

\def\mvstrut#1{\vcenter{\hrule width0pt height#1}}
\def\mhstrut#1{\vcenter{\hrule width#1 height0pt}}

% TODO this is weird; get rid of it.
% mappalette is like mathpalette, except instead of the first argument to the
% given CS being the current math style, it is whatever the given mapfour maps
% the current math style to.
\def\mapfour#1#2#3#4#5{\ifcase #5 #1\or #2\or #3\or #4\fi}
\def\mappalette#1#2#3{\mathchoice
	{\edef\@arg{#10}\ea#2\ea{\@arg}{#3}}{\edef\@arg{#11}\ea#2\ea{\@arg}{#3}}
	{\edef\@arg{#12}\ea#2\ea{\@arg}{#3}}{\edef\@arg{#13}\ea#2\ea{\@arg}{#3}}}

% TODO: remove/replace with ooalign
% Superimposition
% This was mostly an excercise. This would probably
% be better done with alignment macros like ooalign.
\def\supimp#1#2{{%
	\leavevmode
	\setbox1=\hbox{#1}\setbox2=\hbox{#2}%
	\ifdim\wd1<\wd2
		\setbox0=\box1 \setbox1=\box2 \setbox2=\box0
	\fi
	\hbox to \wd1{\hfil\unhbox2\hfil}\llap{\unhbox1}}}
\def\@msupimpinternal#1#2{%
	\supimp{$\mathsurround=0pt \1#1\1#2$}{$\mathsurround=0pt \2#1\2#2$}}
\def\msupimpmap#1#2#3{\mappalette{#1}\@msupimpinternal{{#2}{#3}}}
\def\msupimp{\msupimpmap
	{\mapfour{\dsty\dsty}{\tsty\tsty}{\ssty\ssty}{\sssty\sssty}}}

% Boxed computer-sciency arrays and matrices
% Example usage (in math mode):
%   \narray\\{17}\\{39}\\{14} \;\cdots\; \array\arri{n}\\{7}
\newcount\arrcnt \arrcnt=0
\newdimen\arrlen \arrlen=20pt
\newif\ifdonecell
\def\@mcell#1#2#3{\vcenter{\vboxit{\hbox to#1{%
	\hss$\m@th\mvstrut{#2}\smash{\vcenter{\hbox{$\m@th#3$}}}$\hss}}}}
\def\narray{\let\@arrconv=\the  \arrcnt=0  \array}% 0, 1, 2, ...
\def\uarray{\let\@arrconv=\char \arrcnt=65 \array}% A, B, C, ...
\def\larray{\let\@arrconv=\char \arrcnt=97 \array}% a, b, c, ...
\def\earray{\let\@arrconv=\relax \arrcnt=0 \array}% No labels
\def\arri#1{\def\@arrconv##1{#1}}
\def\array{\donecellfalse \let\\=\arraycell}
\def\@arrmcell{\@mcell\arrlen\arrlen}
\let\@arrconv=\relax
\def\arraycell#1{%
	\ifdonecell \kern-0.4pt \else \donecelltrue \fi
	\mathord{\mathop{\@arrmcell{#1}}\limits
		\ifx\@arrconv\relax \else ^{\@arrconv\arrcnt} \fi}
	\advance \arrcnt by1 }
\def\boxmat#1{\vbox{%
	\offinterlineskip
	\everycr{\noalign{\kern-0.4pt}}%
	\tabskip=0pt
	\kern0.4pt
	\halign{$\m@th\@arrmcell{##}$&&\kern-0.4pt$\m@th\@arrmcell{##}$\crcr
		#1\crcr}%
	\kern0.4pt}}


%%% PROBLEMS %%%
% TODO allow breaking problem statements across pages.

% p@last is last problem-related macro used.
%   0 => other
%   1 => header
%   2 => statement
\newcount\p@last \p@last=0
\newbox\pstmt@box
\def\prob{\@phdr\twelvebf}
\def\part{\@phdr\tenbf}
\def\@phdr#1.{%
	\ifnum\p@last=2 \@endpstmt \else \par \fi
	\ifnum\p@last=0
		\vskip 0pt plus.3\vsize \penalty0 \vskip 0pt plus-.3\vsize
	\fi
	\ifnum\p@last<2 \nobreak\vskip\prob@topskip \fi
	\nointerlineskip\hbox{#1}%
	\p@last=1}
\def\pstmt{%
	\par
	\p@last=2
	\nobreak\medskip
	\setbox\pstmt@box=\vbox\bgroup
		\advance \hsize by -2\prob@sidesize
		\def\nostrut{\let\strut=\relax}%
		\ninept\sl\noindent\strut}
\def\@endpstmt{%
	\ifhmode\unskip\fi\strut\egroup% End the vbox started in \pstmt.
	\dimen0=\ht\pstmt@box \advance \dimen0 by 2pt
	\dimen1=\dp\pstmt@box \advance \dimen1 by 2pt
	\nointerlineskip\hbox to \hsize{%
		\hfil
		\vrule height\dimen0 depth\dimen1
		\hskip\prob@rulegap
		\box\pstmt@box
		\hskip\prob@rulegap
		\hskip 0.4pt plus1fil}%
	\nointerlineskip
	\penalty25\medskip}
\def\psoln{%
	\ifcase\p@last
		\errmessage{psoln must be preceded by prob/part/pstmt}%
	\or
		\nobreak\medskip
	\or
		\@endpstmt
	\fi
	\p@last=0
	\noparskip}


%%% VERBATIM %%%

% Usage:
%   \iverb <arbitrary local initialization> \verb<<an arbitrary delimiter
%   {this} %is
%		$all$ ~verbatim--
%   an arbitrary delimiter
%   Back to non-verbatim.
% \verbpenalty is inserted between lines.
\def\iverb{\begingroup}
\def\verb@term{\errmessage{verb delimiter should be on new line}}
\def\verb@eol{%
	\ifx\verb@next\verb@term% End of verbatim?
		\let\verb@term=\relax% Silence error message.
	\else
		\penalty\verbpenalty
	\fi}
{\obeylines\gdef\verb{%
	\def\@verb<<##1^^M{% Scan delimiter like Unix here doc.
		\long\def\@@verb####1##1{####1\verb@term\endgroup}%
		\@@verb}%
	\def\do##1{\catcode`##1=12 }\dospecials% Init specials
	\def\par{\leavevmode \endgraf \futurelet\verb@next\verb@eol}%
	\obeylines% Init lines
	\verb@obeyspaces% Init spaces
	\@verb}}

% Like Plain TeX \obeyspaces, but use control spaces, not \space.
{\obeyspaces\gdef\verb@obeyspaces{\let =\ \obeyspaces}}

% Convert tabs into 4 spaces (for code listings).
{\catcode`\^^I=13
\gdef\expandtabs{\catcode`\^^I=13\def^^I{\ \ \ \ }}}

% Start code block. Terminate with "EOF" (hence, this is not suitable for code
% that literally contains "EOF").
\def\code{\par \@medbreak \iverb \aftergroup\@medskip \aftergroup\noparskip
	\verbpenalty=1000 \narrowerby{20pt} \parskip=0pt \expandtabs \tt
	\verb<<EOF}


%%% PDFTeX %%%

\ifx\pdfoutput\@undefined \else

% Insert pdf image.
\def\pdfimg#1file #2.pdf{\pdfximage#1{#2.pdf}\pdfrefximage\pdflastximage}

% Color support.
\mathchardef\@colorstackn=\pdfcolorstackinit page {0 g 0 G}
\def\@pdfcolorstackpush#1{\pdfcolorstack\@colorstackn push {#1}}
\def\@pdfcolorstackpop{\pdfcolorstack\@colorstackn pop}
\def\@setcolor#1{\@pdfcolorstackpush{#1}\aftergroup\@pdfcolorstackpop}
\def\setcolorrgb#1#2#3{\@setcolor{#1 #2 #3 rg #1 #2 #3 RG}}
\def\setcolorgrey#1{\@setcolor{#1 g #1 G}}

% Basic colors.
\def\cblack{\setcolorgrey{0}}
\def\cwhite{\setcolorgrey{1}}
\def\cred{\setcolorrgb    {1}{0}{0}}
\def\cgreen{\setcolorrgb  {0}{1}{0}}
\def\cblue{\setcolorrgb   {0}{0}{1}}
\def\ccyan{\setcolorrgb   {0}{1}{1}}
\def\cmagenta{\setcolorrgb{1}{0}{1}}
\def\cyellow{\setcolorrgb {1}{1}{0}}

% Arbitrary HTML-style hex colors.
\def\chex:#1#2#3#4#5#6{%
	\begingroup
	\@hextodec\R#1#2#1#2%
	\@hextodec\G#3#4#3#4%
	\@hextodec\B#5#6#5#6%
	\edef\@{\endgroup\noexpand\setcolorrgb{\R}{\G}{\B}}%
	\@\ignorespaces}

% 16 shades of grey.
\def\cgrey:#1{%
	\begingroup
	\@hextodec\grey#1#1#1#1%
	\edef\@{\endgroup\noexpand\setcolorgrey{\grey}}%
	\@\ignorespaces}

\fi % PDFTeX

\catcode`@=12
\endinput
